<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout/base :: head(${title})}"></head>

<body>
    <div th:replace="~{layout/base :: navbar('propiedades')}"></div>
    <div th:replace="~{layout/base :: messages}"></div>

    <div class="container">
        <a th:href="@{/propiedades}" class="btn btn-secondary mb-3">
            <i class="bi bi-arrow-left"></i> Volver al listado
        </a>

        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="bi bi-boxes"></i>
                    <span th:text="${action} + ' Propiedad Adicional'">Formulario</span>
                </h4>
            </div>
            <div class="card-body">
                <form th:action="${propiedad.id != null} ? @{/propiedades/{id}(id=${propiedad.id})} : @{/propiedades}"
                    method="post" th:object="${propiedad}">

                    <!-- Inmueble asociado -->
                    <div class="mb-4">
                        <label for="inmuebleId" class="form-label">
                            Inmueble <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="inmuebleId" name="inmuebleId" required>
                            <option value="">Seleccionar inmueble...</option>
                            <option th:each="inm : ${inmuebles}" th:value="${inm.id}"
                                th:text="${inm.id + ' - ' + inm.direccion + ' (' + inm.tipoVivienda + ')'}"
                                th:selected="${propiedad.inmueble != null && propiedad.inmueble.id == inm.id}">
                                1 - Calle Larga (Piso)
                            </option>
                        </select>
                        <div class="form-text">
                            <i class="bi bi-info-circle"></i> Seleccione el inmueble al que pertenece esta propiedad
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <!-- Tipo -->
                            <div class="mb-3">
                                <label for="tipo" class="form-label">
                                    Tipo de Propiedad <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="tipo" th:field="*{tipo}" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Garaje">üöó Garaje</option>
                                    <option value="Trastero">üì¶ Trastero</option>
                                    <option value="Piscina">üèä Piscina</option>
                                    <option value="Jard√≠n">üå≥ Jard√≠n</option>
                                    <option value="Terraza">üåÖ Terraza</option>
                                    <option value="Azotea">üè† Azotea</option>
                                    <option value="Parking">üÖøÔ∏è Parking</option>
                                    <option value="S√≥tano">‚¨áÔ∏è S√≥tano</option>
                                    <option value="Patio">ü™¥ Patio</option>
                                    <option value="Zona Com√∫n">üèòÔ∏è Zona Com√∫n</option>
                                </select>
                            </div>

                            <!-- Derrama -->
                            <div class="mb-3">
                                <label for="derrama" class="form-label">
                                    Derrama Mensual (‚Ç¨) <span class="text-danger">*</span>
                                </label>
                                <input type="number" class="form-control" id="derrama" th:field="*{derrama}" required
                                    min="0" step="0.01" placeholder="50.00">
                                <div class="form-text">
                                    <i class="bi bi-info-circle"></i> Coste mensual adicional por esta propiedad
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <!-- IBI -->
                            <div class="mb-3">
                                <label for="ibi" class="form-label">
                                    IBI Anual <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="ibi" th:field="*{ibi}" required
                                    maxlength="45" placeholder="100 ‚Ç¨/a√±o">
                                <div class="form-text">
                                    <i class="bi bi-info-circle"></i> Impuesto de Bienes Inmuebles anual
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Info del inmueble seleccionado -->
                    <div th:if="${propiedad.inmueble != null}" class="alert alert-info mt-3">
                        <h6><i class="bi bi-house-door"></i> Inmueble asociado:</h6>
                        <p class="mb-1">
                            <strong>Direcci√≥n:</strong>
                            <span th:text="${propiedad.inmueble.direccion}">Calle Larga, 10</span>
                        </p>
                        <p class="mb-1">
                            <strong>Tipo:</strong>
                            <span th:text="${propiedad.inmueble.tipoVivienda}">Piso</span>
                        </p>
                        <p class="mb-0">
                            <a th:href="@{/inmuebles/{id}(id=${propiedad.inmueble.id})}" class="btn btn-sm btn-primary">
                                <i class="bi bi-eye me-1"></i> Ver inmueble
                            </a>
                        </p>
                    </div>

                    <!-- Botones -->
                    <div class="d-flex justify-content-between mt-4">
                        <a th:href="@{/propiedades}" class="btn btn-secondary">
                            <i class="bi bi-x-circle me-1"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-save me-1"></i>
                            <span th:text="${action}">Guardar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div th:replace="~{layout/base :: scripts}"></div>
</body>

</html>